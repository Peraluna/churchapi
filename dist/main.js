!function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("express")},function(e,t,r){"use strict";var o=r(3);e.exports=function(e,t,r){try{var n=e.headers.authorization.split(" ")[1],s=o.verify(n,process.env.JWT_KEY);e.userData=s,r()}catch(e){return t.status(401).json({message:"Auth failed for token : "+token})}}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";var o=r(0),n=o.Schema({_id:o.Schema.Types.ObjectId,name:{type:String,required:!0},price:{type:Number,required:!0},productImage:{type:String,required:!0}});e.exports=o.model("Product",n)},function(e,t,r){"use strict";var o=r(6),n=r(7),s=process.env.PORT||3e3;o.createServer(n).listen(s,"localhost"),console.log("Server started on %s:%s : ","localhost",s)},function(e,t){e.exports=require("http")},function(e,t,r){"use strict";var o=function(e){return e&&e.__esModule?e:{default:e}}(r(1));var n=r(8),s=r(9),u=r(0),c=r(10),a=r(13),i=r(16),d=(0,o.default)();u.connect("mongodb://localhost/shop",{useMongoClient:!0});var l=u.connection;l.on("error",console.error.bind(console,"connection error:")),l.once("open",function(){console.log("Connected to mongoDB..."+l.db.databaseName)}),u.Promise=global.Promise,d.use(n("dev")),d.use("/uploads",o.default.static("uploads")),d.use(s.urlencoded({extended:!1})),d.use(s.json()),d.use(function(e,t,r){if(t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept, Authorization"),"OPTIONS"===e.method)return t.header("Access-Control-Allow-Methods","PUT, POST, PATCH, DELETE, GET"),t.status(200).json({});r()}),d.use("/products",c),d.use("/orders",a),d.use("/user",i),d.use(function(e,t,r){var o=new Error("api Not found...");o.status=404,r(o)}),d.use(function(e,t,r,o){r.status(e.status||500),r.json({error:{message:e.message}})}),e.exports=d},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("body-parser")},function(e,t,r){"use strict";var o=r(1).Router(),n=r(11),s=r(2),u=r(12),c=n({storage:n.diskStorage({destination:function(e,t,r){r(null,"./uploads/")},filename:function(e,t,r){r(null,(new Date).toISOString().replace(/:/g,"-")+t.originalname)}}),limits:{fileSize:5242880},fileFilter:function(e,t,r){"image/jpeg"===t.mimetype||"image/png"===t.mimetype?r(null,!0):r(null,!1)}});o.get("/",u.products_get_all),o.post("/",s,c.single("productImage"),u.products_create_product),o.get("/:productId",u.products_get_product),o.patch("/:productId",s,u.products_update_product),o.delete("/:productId",s,u.products_delete),e.exports=o},function(e,t){e.exports=require("multer")},function(e,t,r){"use strict";var o=r(0),n=r(4);t.products_get_all=function(e,t,r){n.find().select("name price _id productImage").exec().then(function(e){var r={count:e.length,products:e.map(function(e){return{name:e.name,price:e.price,productImage:e.productImage,_id:e._id,request:{type:"GET",url:"http://localhost:5000/products/"+e._id}}})};t.status(200).json(r)}).catch(function(e){console.log(e),t.status(500).json({error:e})})},t.products_create_product=function(e,t,r){new n({_id:new o.Types.ObjectId,name:e.body.name,price:e.body.price,productImage:e.file.path}).save().then(function(e){console.log(e),t.status(201).json({message:"Created product successfully",createdProduct:{name:e.name,price:e.price,_id:e._id,request:{type:"GET",url:"http://localhost:5000/products/"+e._id}}})}).catch(function(e){console.log(e),t.status(500).json({error:e})})},t.products_get_product=function(e,t,r){var o=e.params.productId;n.findById(o).select("name price _id productImage").exec().then(function(e){console.log("From database",e),e?t.status(200).json({product:e,request:{type:"GET",url:"http://localhost:5000/products"}}):t.status(404).json({message:"No valid entry found for provided ID"})}).catch(function(e){console.log(e),t.status(500).json({error:e})})},t.products_update_product=function(e,t,r){var o=e.params.productId,s={},u=!0,c=!1,a=void 0;try{for(var i,d=e.body[Symbol.iterator]();!(u=(i=d.next()).done);u=!0){var l=i.value;s[l.propName]=l.value}}catch(e){c=!0,a=e}finally{try{!u&&d.return&&d.return()}finally{if(c)throw a}}n.update({_id:o},{$set:s}).exec().then(function(e){t.status(200).json({message:"Product updated",request:{type:"GET",url:"http://localhost:5000/products/"+o}})}).catch(function(e){console.log(e),t.status(500).json({error:e})})},t.products_delete=function(e,t,r){var o=e.params.productId;n.remove({_id:o}).exec().then(function(e){t.status(200).json({message:"Product deleted",request:{type:"POST",url:"http://localhost:5000/products",body:{name:"String",price:"Number"}}})}).catch(function(e){console.log(e),t.status(500).json({error:e})})}},function(e,t,r){"use strict";var o=r(1).Router(),n=r(2),s=r(14);o.get("/",n,s.orders_get_all),o.post("/",n,s.orders_create_order),o.get("/:orderId",n,s.orders_get_order),o.delete("/:orderId",n,s.orders_delete_order),e.exports=o},function(e,t,r){"use strict";var o=r(0),n=r(15),s=r(4);t.orders_get_all=function(e,t,r){n.find().select("product quantity _id").populate("product","name").exec().then(function(e){t.status(200).json({count:e.length,orders:e.map(function(e){return{_id:e._id,product:e.product,quantity:e.quantity,request:{type:"GET",url:"http://localhost:5000/orders/"+e._id}}})})}).catch(function(e){t.status(500).json({error:e})})},t.orders_create_order=function(e,t,r){s.findById(e.body.productId).then(function(r){return r?new n({_id:o.Types.ObjectId(),quantity:e.body.quantity,product:e.body.productId}).save():t.status(404).json({message:"Product not found"})}).then(function(e){console.log(e),t.status(201).json({message:"Order stored",createdOrder:{_id:e._id,product:e.product,quantity:e.quantity},request:{type:"GET",url:"http://localhost:3000/orders/"+e._id}})}).catch(function(e){console.log(e),t.status(500).json({error:e})})},t.orders_get_order=function(e,t,r){n.findById(e.params.orderId).populate("product").exec().then(function(e){if(!e)return t.status(404).json({message:"Order not found"});t.status(200).json({order:e,request:{type:"GET",url:"http://localhost:3000/orders"}})}).catch(function(e){t.status(500).json({error:e})})},t.orders_delete_order=function(e,t,r){n.remove({_id:e.params.orderId}).exec().then(function(e){t.status(200).json({message:"Order deleted",request:{type:"POST",url:"http://localhost:3000/orders",body:{productId:"ID",quantity:"Number"}}})}).catch(function(e){t.status(500).json({error:e})})}},function(e,t,r){"use strict";var o=r(0),n=o.Schema({_id:o.Schema.Types.ObjectId,product:{type:o.Schema.Types.ObjectId,ref:"Product",required:!0},quantity:{type:Number,default:1}});e.exports=o.model("Order",n)},function(e,t,r){"use strict";var o=r(1).Router(),n=r(17),s=r(2);o.post("/signup",n.user_signup),o.post("/login",n.user_login),o.delete("/:userId",s,n.user_delete),e.exports=o},function(e,t,r){"use strict";var o=r(0),n=r(18),s=r(3),u=r(19);t.user_signup=function(e,t,r){console.log("signing up..."),u.find({email:e.body.email}).exec().then(function(r){if(r.length>=1)return t.status(409).json({message:"Mail exists"});n.hash(e.body.password,10,function(r,n){if(r)return t.status(500).json({error:r});new u({_id:new o.Types.ObjectId,email:e.body.email,password:n}).save().then(function(e){console.log(e),t.status(201).json({message:"User created"})}).catch(function(e){console.log(e),t.status(500).json({error:e})})})})},t.user_login=function(e,t,r){u.find({email:e.body.email}).exec().then(function(r){if(r.length<1)return t.status(401).json({message:"Auth failed"});n.compare(e.body.password,r[0].password,function(e,o){if(e)return t.status(401).json({message:"Auth failed"});if(o){var n=s.sign({email:r[0].email,userId:r[0]._id},process.env.JWT_KEY,{expiresIn:"1h"});return t.status(200).json({message:"Auth successful",token:n})}t.status(401).json({message:"Auth failed"})})}).catch(function(e){console.log(e),t.status(500).json({error:e})})},t.user_delete=function(e,t,r){u.remove({_id:e.params.userId}).exec().then(function(e){t.status(200).json({message:"User deleted"})}).catch(function(e){console.log(e),t.status(500).json({error:e})})}},function(e,t){e.exports=require("bcrypt")},function(e,t,r){"use strict";var o=r(0),n=o.Schema({_id:o.Schema.Types.ObjectId,email:{type:String,required:!0,unique:!0,match:/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/},password:{type:String,required:!0}});e.exports=o.model("User",n)}]);